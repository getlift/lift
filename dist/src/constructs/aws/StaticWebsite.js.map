{
  "version": 3,
  "sources": ["../../../../src/constructs/aws/StaticWebsite.ts"],
  "sourcesContent": ["import * as cloudfront from \"aws-cdk-lib/aws-cloudfront\";\nimport { FunctionEventType } from \"aws-cdk-lib/aws-cloudfront\";\nimport type { Construct as CdkConstruct } from \"constructs\";\nimport type { AwsProvider } from \"@lift/providers\";\nimport type { BucketProps } from \"aws-cdk-lib/aws-s3\";\nimport { RemovalPolicy } from \"aws-cdk-lib\";\nimport { redirectToMainDomain } from \"../../classes/cloudfrontFunctions\";\nimport { getCfnFunctionAssociations } from \"../../utils/getDefaultCfnFunctionAssociations\";\nimport { ensureNameMaxLength } from \"../../utils/naming\";\nimport type { CommonStaticWebsiteConfiguration } from \"./abstracts/StaticWebsiteAbstract\";\nimport { COMMON_STATIC_WEBSITE_DEFINITION, StaticWebsiteAbstract } from \"./abstracts/StaticWebsiteAbstract\";\n\nexport class StaticWebsite extends StaticWebsiteAbstract {\n    public static type = \"static-website\";\n    public static schema = COMMON_STATIC_WEBSITE_DEFINITION;\n\n    constructor(\n        scope: CdkConstruct,\n        protected readonly id: string,\n        protected readonly configuration: CommonStaticWebsiteConfiguration,\n        protected readonly provider: AwsProvider\n    ) {\n        super(scope, id, configuration, provider);\n\n        const cfnDistribution = this.distribution.node.defaultChild as cloudfront.CfnDistribution;\n        const requestFunction = this.createRequestFunction();\n\n        if (requestFunction === null) {\n            return;\n        }\n\n        const defaultBehaviorFunctionAssociations = getCfnFunctionAssociations(cfnDistribution);\n\n        cfnDistribution.addOverride(\"Properties.DistributionConfig.DefaultCacheBehavior.FunctionAssociations\", [\n            ...defaultBehaviorFunctionAssociations,\n            { EventType: FunctionEventType.VIEWER_REQUEST, FunctionARN: requestFunction.functionArn },\n        ]);\n    }\n\n    private createRequestFunction(): cloudfront.Function | null {\n        let additionalCode = \"\";\n\n        if (this.configuration.redirectToMainDomain === true) {\n            additionalCode += redirectToMainDomain(this.domains);\n        }\n\n        if (additionalCode === \"\") {\n            return null;\n        }\n\n        const code = `function handler(event) {\n    var request = event.request;${additionalCode}\n    return request;\n}`;\n\n        const functionName = ensureNameMaxLength(\n            `${this.provider.stackName}-${this.provider.region}-${this.id}-request`,\n            64\n        );\n\n        return new cloudfront.Function(this, \"RequestFunction\", {\n            functionName,\n            code: cloudfront.FunctionCode.fromInline(code),\n        });\n    }\n\n    getBucketProps(): BucketProps {\n        return {\n            // Enable static website hosting\n            websiteIndexDocument: \"index.html\",\n            websiteErrorDocument: this.errorPath(),\n            // public read access is required when enabling static website hosting\n            publicReadAccess: true,\n            // For a static website, the content is code that should be versioned elsewhere\n            removalPolicy: RemovalPolicy.DESTROY,\n        };\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA,iBAA4B;AAC5B,4BAAkC;AAIlC,yBAA8B;AAC9B,iCAAqC;AACrC,+CAA2C;AAC3C,oBAAoC;AAEpC,mCAAwE;AAEjE,4BAA4B,mDAAsB;AAAA,EAIrD,YACI,OACmB,IACA,eACA,UACrB;AACE,UAAM,OAAO,IAAI,eAAe;AAJb;AACA;AACA;AAInB,UAAM,kBAAkB,KAAK,aAAa,KAAK;AAC/C,UAAM,kBAAkB,KAAK;AAE7B,QAAI,oBAAoB,MAAM;AAC1B;AAAA;AAGJ,UAAM,sCAAsC,yEAA2B;AAEvE,oBAAgB,YAAY,2EAA2E;AAAA,MACnG,GAAG;AAAA,MACH,EAAE,WAAW,wCAAkB,gBAAgB,aAAa,gBAAgB;AAAA;AAAA;AAAA,EAI5E,wBAAoD;AACxD,QAAI,iBAAiB;AAErB,QAAI,KAAK,cAAc,yBAAyB,MAAM;AAClD,wBAAkB,qDAAqB,KAAK;AAAA;AAGhD,QAAI,mBAAmB,IAAI;AACvB,aAAO;AAAA;AAGX,UAAM,OAAO;AAAA,kCACa;AAAA;AAAA;AAI1B,UAAM,eAAe,uCACjB,GAAG,KAAK,SAAS,aAAa,KAAK,SAAS,UAAU,KAAK,cAC3D;AAGJ,WAAO,IAAI,WAAW,SAAS,MAAM,mBAAmB;AAAA,MACpD;AAAA,MACA,MAAM,WAAW,aAAa,WAAW;AAAA;AAAA;AAAA,EAIjD,iBAA8B;AAC1B,WAAO;AAAA,MAEH,sBAAsB;AAAA,MACtB,sBAAsB,KAAK;AAAA,MAE3B,kBAAkB;AAAA,MAElB,eAAe,iCAAc;AAAA;AAAA;AAAA;AA7DvB,AADX,cACW,OAAO;AACP,AAFX,cAEW,SAAS;",
  "names": []
}
