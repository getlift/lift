{
  "version": 3,
  "sources": ["../../../test/unit/databasesDynamoDBSingleTable.test.ts"],
  "sourcesContent": ["import { pluginConfigExt, runServerless } from \"../utils/runServerless\";\n\ndescribe(\"databasesDynamoDBSingleTable\", () => {\n    let cfTemplate: {\n        Resources: Record<string, { Properties: Record<string, unknown> }>;\n        Outputs: Record<string, unknown>;\n    };\n    let computeLogicalId: (...address: string[]) => string;\n    const tableUseCases = [\n        [\"databaseWithoutSecondaryIndexes\"],\n        [\"databaseWithLocalSecondaryIndexes\"],\n        [\"databaseWithGlobalSecondaryIndexes\"],\n    ];\n\n    beforeAll(async () => {\n        ({ cfTemplate, computeLogicalId } = await runServerless({\n            fixture: \"databasesDynamoDBSingleTable\",\n            configExt: pluginConfigExt,\n            command: \"package\",\n        }));\n    });\n    describe(\"common tests\", () => {\n        test.each(tableUseCases)(\n            \"%p - should ensure deletion policy and update replace policy are retain\",\n            (tableUseCase) => {\n                expect(cfTemplate.Resources[computeLogicalId(tableUseCase, \"Table\")]).toMatchObject({\n                    UpdateReplacePolicy: \"Retain\",\n                    DeletionPolicy: \"Retain\",\n                });\n            }\n        );\n        test.each(tableUseCases)(\"%p - should provision generic names for primary index\", (tableUseCase) => {\n            expect(\n                cfTemplate.Resources[computeLogicalId(tableUseCase, \"Table\")].Properties.AttributeDefinitions\n            ).toContainEqual({ AttributeName: \"PK\", AttributeType: \"S\" });\n            expect(\n                cfTemplate.Resources[computeLogicalId(tableUseCase, \"Table\")].Properties.AttributeDefinitions\n            ).toContainEqual({ AttributeName: \"SK\", AttributeType: \"S\" });\n            expect(cfTemplate.Resources[computeLogicalId(tableUseCase, \"Table\")].Properties.KeySchema).toEqual([\n                {\n                    AttributeName: \"PK\",\n                    KeyType: \"HASH\",\n                },\n                {\n                    AttributeName: \"SK\",\n                    KeyType: \"RANGE\",\n                },\n            ]);\n        });\n    });\n    it(\"should use generic names for LSI\", () => {\n        for (let localSecondaryIndex = 1; localSecondaryIndex <= 5; localSecondaryIndex++) {\n            expect(\n                cfTemplate.Resources[computeLogicalId(\"databaseWithLocalSecondaryIndexes\", \"Table\")].Properties\n                    .AttributeDefinitions\n            ).toContainEqual({ AttributeName: `LSI-${localSecondaryIndex}-SK`, AttributeType: \"S\" });\n        }\n        expect(\n            cfTemplate.Resources[computeLogicalId(\"databaseWithLocalSecondaryIndexes\", \"Table\")].Properties\n                .LocalSecondaryIndexes\n        ).toEqual(\n            Array.from({ length: 5 }, (_, i) => i + 1).map((localSecondaryIndex) => {\n                return {\n                    IndexName: `LSI-${localSecondaryIndex}`,\n                    KeySchema: [\n                        {\n                            AttributeName: \"PK\",\n                            KeyType: \"HASH\",\n                        },\n                        {\n                            AttributeName: `LSI-${localSecondaryIndex}-SK`,\n                            KeyType: \"RANGE\",\n                        },\n                    ],\n                    Projection: { ProjectionType: \"ALL\" },\n                };\n            })\n        );\n    });\n    it(\"should use generic names for GSI\", () => {\n        for (let globalSecondaryIndex = 1; globalSecondaryIndex <= 2; globalSecondaryIndex++) {\n            expect(\n                cfTemplate.Resources[computeLogicalId(\"databaseWithGlobalSecondaryIndexes\", \"Table\")].Properties\n                    .AttributeDefinitions\n            ).toContainEqual({ AttributeName: `GSI-${globalSecondaryIndex}-PK`, AttributeType: \"S\" });\n            expect(\n                cfTemplate.Resources[computeLogicalId(\"databaseWithGlobalSecondaryIndexes\", \"Table\")].Properties\n                    .AttributeDefinitions\n            ).toContainEqual({ AttributeName: `GSI-${globalSecondaryIndex}-SK`, AttributeType: \"S\" });\n        }\n        expect(\n            cfTemplate.Resources[computeLogicalId(\"databaseWithGlobalSecondaryIndexes\", \"Table\")].Properties\n                .GlobalSecondaryIndexes\n        ).toEqual(\n            Array.from({ length: 2 }, (_, i) => i + 1).map((globalSecondaryIndex) => {\n                return {\n                    IndexName: `GSI-${globalSecondaryIndex}`,\n                    KeySchema: [\n                        {\n                            AttributeName: `GSI-${globalSecondaryIndex}-PK`,\n                            KeyType: \"HASH\",\n                        },\n                        {\n                            AttributeName: `GSI-${globalSecondaryIndex}-SK`,\n                            KeyType: \"RANGE\",\n                        },\n                    ],\n                    Projection: { ProjectionType: \"ALL\" },\n                };\n            })\n        );\n    });\n\n    it(\"allows overriding table properties\", () => {\n        expect(cfTemplate.Resources[computeLogicalId(\"extendedDatabase\", \"Table\")].Properties).toMatchObject({\n            TableClass: \"STANDARD_INFREQUENT_ACCESS\",\n        });\n    });\n});\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA,2BAA+C;AAE/C,SAAS,gCAAgC,MAAM;AAC3C,MAAI;AAIJ,MAAI;AACJ,QAAM,gBAAgB;AAAA,IAClB,CAAC;AAAA,IACD,CAAC;AAAA,IACD,CAAC;AAAA;AAGL,YAAU,YAAY;AAClB,IAAC,GAAE,YAAY,qBAAqB,MAAM,wCAAc;AAAA,MACpD,SAAS;AAAA,MACT,WAAW;AAAA,MACX,SAAS;AAAA;AAAA;AAGjB,WAAS,gBAAgB,MAAM;AAC3B,SAAK,KAAK,eACN,2EACA,CAAC,iBAAiB;AACd,aAAO,WAAW,UAAU,iBAAiB,cAAc,WAAW,cAAc;AAAA,QAChF,qBAAqB;AAAA,QACrB,gBAAgB;AAAA;AAAA;AAI5B,SAAK,KAAK,eAAe,yDAAyD,CAAC,iBAAiB;AAChG,aACI,WAAW,UAAU,iBAAiB,cAAc,UAAU,WAAW,sBAC3E,eAAe,EAAE,eAAe,MAAM,eAAe;AACvD,aACI,WAAW,UAAU,iBAAiB,cAAc,UAAU,WAAW,sBAC3E,eAAe,EAAE,eAAe,MAAM,eAAe;AACvD,aAAO,WAAW,UAAU,iBAAiB,cAAc,UAAU,WAAW,WAAW,QAAQ;AAAA,QAC/F;AAAA,UACI,eAAe;AAAA,UACf,SAAS;AAAA;AAAA,QAEb;AAAA,UACI,eAAe;AAAA,UACf,SAAS;AAAA;AAAA;AAAA;AAAA;AAKzB,KAAG,oCAAoC,MAAM;AACzC,aAAS,sBAAsB,GAAG,uBAAuB,GAAG,uBAAuB;AAC/E,aACI,WAAW,UAAU,iBAAiB,qCAAqC,UAAU,WAChF,sBACP,eAAe,EAAE,eAAe,OAAO,0BAA0B,eAAe;AAAA;AAEtF,WACI,WAAW,UAAU,iBAAiB,qCAAqC,UAAU,WAChF,uBACP,QACE,MAAM,KAAK,EAAE,QAAQ,KAAK,CAAC,GAAG,MAAM,IAAI,GAAG,IAAI,CAAC,wBAAwB;AACpE,aAAO;AAAA,QACH,WAAW,OAAO;AAAA,QAClB,WAAW;AAAA,UACP;AAAA,YACI,eAAe;AAAA,YACf,SAAS;AAAA;AAAA,UAEb;AAAA,YACI,eAAe,OAAO;AAAA,YACtB,SAAS;AAAA;AAAA;AAAA,QAGjB,YAAY,EAAE,gBAAgB;AAAA;AAAA;AAAA;AAK9C,KAAG,oCAAoC,MAAM;AACzC,aAAS,uBAAuB,GAAG,wBAAwB,GAAG,wBAAwB;AAClF,aACI,WAAW,UAAU,iBAAiB,sCAAsC,UAAU,WACjF,sBACP,eAAe,EAAE,eAAe,OAAO,2BAA2B,eAAe;AACnF,aACI,WAAW,UAAU,iBAAiB,sCAAsC,UAAU,WACjF,sBACP,eAAe,EAAE,eAAe,OAAO,2BAA2B,eAAe;AAAA;AAEvF,WACI,WAAW,UAAU,iBAAiB,sCAAsC,UAAU,WACjF,wBACP,QACE,MAAM,KAAK,EAAE,QAAQ,KAAK,CAAC,GAAG,MAAM,IAAI,GAAG,IAAI,CAAC,yBAAyB;AACrE,aAAO;AAAA,QACH,WAAW,OAAO;AAAA,QAClB,WAAW;AAAA,UACP;AAAA,YACI,eAAe,OAAO;AAAA,YACtB,SAAS;AAAA;AAAA,UAEb;AAAA,YACI,eAAe,OAAO;AAAA,YACtB,SAAS;AAAA;AAAA;AAAA,QAGjB,YAAY,EAAE,gBAAgB;AAAA;AAAA;AAAA;AAM9C,KAAG,sCAAsC,MAAM;AAC3C,WAAO,WAAW,UAAU,iBAAiB,oBAAoB,UAAU,YAAY,cAAc;AAAA,MACjG,YAAY;AAAA;AAAA;AAAA;",
  "names": []
}
